<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Game Xóc Đĩa - Tham gia để chơi</title>
  <style>
    body {margin:0;display:flex;justify-content:center;align-items:center;height:100vh;background:#0b1220;color:#fff;font-family:Arial, sans-serif;}
    #joinScreen, #gameScreen {display:none;flex-direction:column;align-items:center;}
    .btn {padding:12px 24px;border:none;border-radius:10px;font-size:18px;cursor:pointer;font-weight:bold;box-shadow:0 4px 8px rgba(0,0,0,0.4);}
    .btn-join {background:linear-gradient(90deg,#f59e0b,#fb923c);color:#07203a;}
    .btn-play {background:linear-gradient(90deg,#34d399,#10b981);color:#05201f;margin-top:10px;}
    canvas {background:#08304a;border-radius:12px;margin-top:20px;box-shadow:0 4px 10px rgba(0,0,0,0.5);}
    .bet-controls {margin-top:15px;display:flex;flex-direction:column;align-items:center;gap:10px;}
    input, select {padding:8px 12px;border-radius:6px;border:none;text-align:center;font-size:16px;box-shadow:inset 0 2px 4px rgba(0,0,0,0.2);}
    .balance {margin-top:10px;font-size:18px;font-weight:bold;color:#facc15;}
  </style>
</head>
<body>
  <div id="joinScreen">
    <h2>Chào mừng đến game Xóc Đĩa</h2>
    <p>Bấm nút bên dưới để tham gia nhóm Telegram và mở game</p>
    <button id="joinBtn" class="btn btn-join">Tham gia & Mở Telegram</button>
  </div>

  <div id="gameScreen">
    <h2>Game Xóc Đĩa</h2>
    <div class="balance">Số dư: <span id="balance">1000</span></div>
    <canvas id="board" width="500" height="300"></canvas>
    <div class="bet-controls">
      <label>Số tiền cược: <input id="betAmount" type="number" min="1" value="10"></label>
      <label>Chọn cửa: 
        <select id="betChoice">
          <option value="chan">Chẵn</option>
          <option value="le">Lẻ</option>
          <option value="4trang">4 Trắng</option>
          <option value="4do">4 Đỏ</option>
          <option value="3trang1do">3 Trắng 1 Đỏ</option>
          <option value="3do1trang">3 Đỏ 1 Trắng</option>
        </select>
      </label>
    </div>
    <p id="status">Chờ...</p>
    <button id="playBtn" class="btn btn-play">Bắt đầu ván</button>
  </div>

<script>
const joinScreen = document.getElementById('joinScreen');
const gameScreen = document.getElementById('gameScreen');
const joinBtn = document.getElementById('joinBtn');
const playBtn = document.getElementById('playBtn');
const statusEl = document.getElementById('status');
const canvas = document.getElementById('board');
const ctx = canvas.getContext('2d');
const betAmountEl = document.getElementById('betAmount');
const betChoiceEl = document.getElementById('betChoice');
const balanceEl = document.getElementById('balance');
let balance = 1000;

joinScreen.style.display = 'flex';

joinBtn.addEventListener('click', () => {
  window.open('https://t.me/htuanpremium0', '_blank');
  joinScreen.style.display = 'none';
  gameScreen.style.display = 'flex';
});

playBtn.addEventListener('click', () => {
  const bet = parseInt(betAmountEl.value) || 0;
  const choice = betChoiceEl.value;
  if(bet < 1){alert('Nhập số tiền cược hợp lệ');return;}
  if(bet > balance){alert('Không đủ số dư');return;}
  balance -= bet;
  updateBalance();
  statusEl.textContent = 'Đang lắc...';
  animateShake().then(result => {
    const parity = result % 2 === 0 ? 'chan' : 'le';
    let win = false;
    if (choice === 'chan' && parity === 'chan') win = true;
    if (choice === 'le' && parity === 'le') win = true;
    if (choice === '4trang' && result === 4) win = true;
    if (choice === '4do' && result === 0) win = true;
    if (choice === '3trang1do' && result === 3) win = true;
    if (choice === '3do1trang' && result === 1) win = true;

    if(win){
      const winAmount = bet * 2;
      balance += winAmount;
      statusEl.textContent = `Thắng! Kết quả: ${result} trắng, +${winAmount}`;
    } else {
      statusEl.textContent = `Thua! Kết quả: ${result} trắng`;
    }
    updateBalance();
  });
});

function updateBalance(){
  balanceEl.textContent = balance;
}

function drawTable(headsCount=0){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#0b4a6a';
  ctx.beginPath();
  ctx.arc(250,150,100,0,Math.PI*2);
  ctx.fill();
  for(let i=0;i<4;i++){
    const angle = (i/4)*Math.PI*2;
    drawCoin(250+80*Math.cos(angle),150+80*Math.sin(angle), i<headsCount);
  }
}

function drawCoin(x,y,heads){
  ctx.beginPath();
  ctx.arc(x,y,25,0,Math.PI*2);
  ctx.fillStyle = '#ffd27a';
  ctx.fill();
  ctx.stroke();
  ctx.fillStyle = '#073642';
  ctx.font = 'bold 16px Arial';
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  ctx.fillText(heads?'H':'T',x,y);
}

function animateShake(){
  return new Promise(resolve=>{
    const duration = 1000;
    const start = performance.now();
    function frame(t){
      const p = Math.min(1,(t-start)/duration);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      const amp = (1-p)*10;
      for(let i=0;i<4;i++){
        const angle = (i/4)*Math.PI*2;
        drawCoin(250+80*Math.cos(angle)+Math.random()*amp,150+80*Math.sin(angle)+Math.random()*amp, Math.random()>0.5);
      }
      if(p<1) requestAnimationFrame(frame);
      else {
        const headsCount = Math.floor(Math.random()*5);
        drawTable(headsCount);
        resolve(headsCount);
      }
    }
    requestAnimationFrame(frame);
  });
}

drawTable();
</script>
</body>
</html>
